# UIProbe

Unity UI 界面探针工具，提供预制体索引、界面快照记录、重名检测等功能。

📖 **[点击查看完整使用手册 (User Manual)](UserManual.md)**

## ✨ 最新更新 (v2.5.0)

### 预重命名功能 (Pre-Rename) 📋
- **延迟应用机制**：提前规划GameObject重命名，保存为JSON文件，稍后导入应用
- **团队协作友好**：
  - JSON文件提交到Git，团队成员同步导入
  - 避免"代码已改、节点未改"导致的引用失效
  - 提前规划好重命名映射，代码和预制体分开提交
- **完整工作流**：
  - **导出**：输入新名称 → 导出JSON（不应用）
  - **开发**：根据新名称修改代码引用
  - **导入**：选择JSON → 自动填充输入框（蓝色背景标记）
  - **应用**：批量应用或单个应用，保留动画修复提示
- **安全可控**：
  - 导入后可预览、手动调整、撤销单个映射
  - 批量应用前显示确认对话框
  - 保留现有的动画路径修复机制
- **JSON格式**：包含节点路径、新旧名称、预制体信息、导出时间，便于版本追溯

**使用场景：**
- 🔄 **大规模重命名**：规划好所有改名，一次性应用
- 👥 **团队协作**：一人规划，其他人导入应用
- 📝 **配合代码修改**：先导出JSON → 改代码 → 再应用重命名

### 预制体综合检测 (增强版) 🔍
- **多维度 UI 检查**：在一个面板集成多种检测规则，全方位扫描 UI 问题
  - **不必要的 Raycast Target**：检测并关闭无交互组件的 Raycast Target，提升性能
  - **资源缺失检测**：扫描丢失的 Sprite 图片、字体引用
  - **组件完整性**：检测 Missing Script 和空引用组件
- **综合检测面板**：
  - **动态筛选**：根据检测结果自动生成筛选标签，快速聚焦特定问题
  - **批量修复**：支持**多选**和**批量关闭** Raycast Target，一键优化性能
  - **可视化定位**：点击结果直接 Ping 到目标节点
- **工作流整合**：
  - 原 "重名检测" 升级为 "预制体综合检测"
  - 包含 "综合检测" (新)、"重命名修改"、"历史记录" 三大子功能
  - 支持对当前打开的预制体进行一键扫描

---

## ✨ v2.4.0 功能

### TMP 富文本生成器 ✍️
- **可视化编辑**：无需记忆富文本标签，通过可视化界面生成 TextMeshPro 富文本代码
- **基础格式支持**：颜色、字号、粗体、斜体、下划线、删除线、透明度
- **预设快捷设置**：10 种常用颜色 + 5 个预设字号，一键应用
- **自定义调节**：自定义颜色选择器 + 字号滑块（10-60）+ 透明度滑块（0-100%）
- **累积模式**：对同一文本多次应用不同格式，完美处理复杂多彩文本
- **格式历史记录**：显示已应用的所有格式，支持撤销和删除单个格式
- **一键复制**：生成的富文本代码一键复制到剪贴板，直接粘贴使用

**使用场景：**
- 🎮 **游戏策划**：快速生成任务描述、对话文本等多彩显示效果
- 🎨 **UI 美术**：配置物品描述、等级显示等分级高亮文本
- 📝 **配置表编辑**：直接生成标准格式的富文本配置字段

**累积模式示例：**
```
原始文本: "成功从[普通]-旧日镇撤离1次。"
步骤1: 选中"普通"(4-6) → 白色 → 累积应用
步骤2: 选中"旧日镇"(8-11) → 蓝色 → 累积应用  
步骤3: 选中"1"(13-14) → 金色 → 累积应用
→ 一次性复制最终结果！
```

---

## ✨ v2.3.0 功能

### 可配置拾取方式 🖱️
- **多种拾取方式**：支持右键、Ctrl+左键、中键、Alt+左键四种拾取方式
- **解决按钮触发问题**：右键拾取不会触发按钮的 onClick 事件，避免意外弹窗
- **灵活配置**：在设置页面选择最适合的拾取方式，配置持久化
- **UI 显示**：拾取页签实时显示当前使用的拾取方式
- **向后兼容**：默认使用右键拾取，旧配置自动兼容

**推荐设置：** 使用右键拾取（默认），既不会触发 UI 交互，操作也最方便。

**使用方法：**
1. 打开 UIProbe → 设置 → "运行时拾取方式"
2. 选择拾取方式（右键/Ctrl+左键/中键/Alt+左键）
3. Play 模式下使用选定的方式拾取 UI 元素

---

## ✨ v2.2.0 功能

### 游戏截屏功能 📸
- **Play 模式截屏**：在运行时对游戏画面进行高质量截屏
- **灵活分辨率设置**：支持游戏分辨率或自定义分辨率（含 1080p、720p、2K、4K 快捷预设）
- **超采样支持**：1x-4x 超采样倍数，显著提升截图质量和清晰度
- **透明背景截屏**：实验性透明背景功能，适合 UI 元素截图
- **快捷键操作**：F12 快速截屏，无需中断游戏
- **自动存储管理**：自动保存到 `UIProbe/Screenshots/` 文件夹，时间戳命名防止覆盖
- **便捷查看**：一键打开截图文件夹或直接查看最新截图

**使用场景：**
- 🎮 **游戏开发**：记录 UI 界面、对比美术效果、保存 BUG 复现画面
- 🎨 **UI 设计**：导出透明背景 UI 元素、生成高分辨率原型图
- 📝 **文档制作**：编写操作手册、制作教程素材、展示功能特性

---

## ✨ v2.1.0 功能

### 多类型资源引用系统 🚀
- **预制体嵌套引用追踪**：自动扫描预制体内嵌套的预制体实例，记录层级关系
- **通用资源引用架构**：统一的 `AssetReference` 系统，支持图片、预制体、材质、字体等多种资源类型
- **索引页增强显示**：预制体列表显示多种资源引用统计（🖼 图片、📦 预制体等）
- **详情分组展示**：按资源类型分组显示引用详情，图标直观，可点击定位
- **资源查找页升级**：新增资源类型选择器，支持按类型搜索（图片/预制体/材质/字体）
- **预制体反查功能**：搜索某个预制体，快速找到所有嵌套使用它的父预制体
- **便捷交互**：点击预制体引用可直接定位并选中资源

**使用场景：**
- 📊 **影响范围评估**：修改通用预制体前，查看所有引用它的父预制体
- 🔍 **资源依赖分析**：查看预制体使用了哪些外部预制体和图片资源
- 🎯 **快速定位**：通过资源名称反向查找使用它的所有预制体

---

## ✨ v2.0.0 功能

### 统一配置系统 🎯
- **文件化配置**：所有设置保存到 `UIProbe/Settings/config.json`，脱离Unity EditorPrefs
- **跨项目共享**：配置文件独立于Unity项目，可在不同项目间共享
- **便于备份**：配置文件可直接拷贝、备份或纳入版本控制
- **自动迁移**：首次运行自动从EditorPrefs迁移，无需手动操作
- **JSON格式**：配置文件可读可编辑，方便手动调整

### 配置文件位置
```
Windows: C:\Users\<用户名>\AppData\Roaming\UIProbe\Settings\config.json
macOS: ~/Library/Application Support/UIProbe/Settings/config.json
```

---

## ✨ v1.9.0 功能

### 图片规范化工具
- **统一尺寸**：将不同尺寸的图片批量规范化到统一尺寸
- **保持内容**：保持非透明内容不变形，仅扩展透明区域
- **灵活对齐**：支持居中对齐或保持原位两种模式
- **任意路径**：支持处理项目外文件夹的图片
- **批量处理**：一键处理整个文件夹（含子文件夹）
- **安全选项**：可选覆盖原文件或生成新文件（自定义后缀）

---

## ✨ v1.8.0 功能

### 图片资源引用追踪
- **双向查询**：既能查看预制体使用了哪些图片，也能查看图片被哪些预制体引用
- **索引详情**：在预制体索引中点击展开按钮，可查看该预制体使用的所有图片资源
- **反向搜索**：新增"资源引用"标签页，搜索图片资源即可查看所有使用它的预制体
- **详细信息**：显示图片名称、组件类型（Image/RawImage）、节点层级路径
- **快速定位**：点击图片名即可在 Project 窗口定位该资源

---

## ✨ v1.7.8 功能

### 修改日志追踪 (CSV)
- **自动记录**：在重名检测中修改节点名称时，自动记录修改详情
- **日志生成**：点击"完成修改并生成日志"按钮，自动生成标准CSV报告
- **详细信息**：CSV包含预制体名称、修改前/后名称、完整节点路径、修改时间
- **便于存档**：日志文件按日期归档在 `Modification_Logs` 文件夹中
- **快捷访问**：设置页面新增快速打开修改日志文件夹的按钮

---

## ✨ v1.7.7 功能

### 动画路径自动修复 (增强版)
- **精确层级匹配**：修复逻辑升级为基于层级路径的精确匹配，彻底解决同名节点误伤问题
- **智能引用检测**：重命名节点时，自动检测预制体中关联的动画剪辑
- **一键批量修复**：发现断连的动画引用时，可一键批量更新所有从属的 AnimationClip
- **防误操作**：提供操作确认对话框，告知将影响的动画和属性列表

---

## ✨ v1.7.6 功能

### 动画路径自动修复 (基础版)
- **如果从旧版本升级，建议直接使用 v1.7.7，包含更安全的修复逻辑**

---

## ✨ v1.7.5 功能

### 文件夹排除过滤
- **团队协作支持**：导入批量检测结果后可按文件夹过滤
- **可视化选择**：展开过滤面板，勾选/取消勾选要显示的文件夹
- **问题数统计**：每个文件夹显示包含的问题预制体数量
- **持久化设置**：排除的文件夹自动保存，下次导入自动应用
- **快捷操作**：支持"全选"和"全不选"快速切换

**使用场景**：团队分工时，每个成员只需关注自己负责的模块文件夹

---

## ✨ v1.7.4 功能

### CSV导出增强
- **双模式导出**：批量检测结果支持两种导出模式
  - **简化模式**：预制体+重复节点汇总（名称+数量）
  - **详细模式**：每个重复节点完整路径单独一行
- **智能过滤**：自动过滤无重复命名的预制体，只导出有问题的项
- **路径优化**：详细模式显示"所属文件夹"而非完整预制体路径，避免冗余

---

## ✨ v1.7.3 功能

### Device Simulator支持
- **触摸输入支持**：运行时拾取(Picker)现在支持触摸输入
- **Simulator兼容**：可在Unity Device Simulator中正常使用拾取功能

### CSV导出增强
- **完整字段导出**：批量检测CSV新增"是否已处理"、"处理时间"、"是否已弃用"、"弃用时间"列

### UI优化
- **布局修复**：重命名检测组收起时不再占用过多空间
- **按钮对齐**：弃用/打开按钮统一宽度，确保对齐


## ✨ v1.7.2 功能

### 用户体验改进
- **输入框焦点优化**：重命名应用后自动清空输入框并释放焦点
- **弃用标记功能**：批量检测支持标记已弃用预制体
- **自动过滤**：导入批量结果时自动排除已弃用项
- **视觉反馈**：已弃用项显示灰色背景和⛔图标

**弃用功能使用：**
- 点击卡片上的"弃用"按钮标记废弃预制体
- 已弃用项在下次导入时自动过滤
- 可随时点击"恢复"取消弃用状态

---

## ✨ v1.7.1 功能

### 历史记录三层结构优化
- **智能分组**：同一预制体在同一天的记录合并到一个JSON文件
- **三层折叠**：日期 → 预制体 → 具体记录
- **紧凑显示**：预制体内记录采用紧凑格式，节省空间
- **批量管理**：可删除整个预制体的所有记录
- **避免重复**：不再为每次重命名创建新文件

**UI结构示例：**
```
📅 2026-01-19 (2个预制体, 共5条)
  📦 MainPanel (3条记录)
    1. 20:30:45 - Button → CloseButton
    2. 20:41:23 - Image → BackgroundImage
  📦 DialogPanel (2条记录)
    1. 20:55:57 - Panel → ContentPanel
```

---

## ✨ v1.7.0 功能

### 1. 重命名历史记录系统重构
- **文件组织**：按日期文件夹自动组织（Rename_History/2026-01-19/）
- **独立存储**：每条记录独立JSON文件（预制体名_时间戳.json）
- **折叠展示**：按日期分组，点击展开/收起
- **灵活删除**：支持删除单条记录或整个日期文件夹
- **性能优化**：延迟加载，避免单文件过大

### 2. 重命名工作流优化
- **焦点保持**：重命名后自动展开对应组，无需滚动查找
- **智能提示**：组消失时（已无重名）控制台显示提示
- **流畅体验**：连续处理同一组节点更便捷

### 3. 设置持久化修复
- **自动保存**：所有检测规则修改立即保存
- **跨会话保持**：关闭重开窗口设置不会重置
- **完整支持**：检测范围、过滤模式、前缀、白名单、黑名单全部自动保存

---

## ✨ v1.6 功能

### 1. 批量检测工作流优化
- **进度跟踪**：支持处理状态标记，已处理卡片显示绿色背景✅
- **智能完成**：打开预制体自动检测，无重名自动标记完成
- **返回功能**：单个检测显示"返回批量结果"按钮
- **进度显示**：工具栏显示处理进度（已处理 X/Y）
- **状态持久化**：处理状态保存到JSON，跨会话保持

### 2. 界面体验优化  
- **子标签系统**：重名检测页面分为「检测功能」和「历史记录」
- **自动刷新**：重命名后自动重新检测，实时更新
- **搜索历史管理**：历史记录新增✕删除按钮
- **CSV自动保存**：批量检测CSV自动保存到配置目录

---

## ✨ v1.5 功能

### 1. 索引持久化
- **自动保存索引**：刷新索引后自动保存到磁盘，无需每次重新扫描。
- **自动加载索引**：打开窗口时自动加载上次的索引，启动更快速。
- **智能检测**：自动检测索引根路径变化，提示刷新。
- **显示更新时间**：界面显示索引的上次更新时间。
- **存储位置**：`<主文件夹>/IndexCache.json`（默认在AppData）

### 2. 界面优化
- **搜索清除按钮**：搜索框输入后显示 ✕ 按钮，一键清空并恢复索引状态。
- **CSV格式改进**：批量检测导出增加"是否存在重复命名"列（是/否），便于快速筛选。

---

## ✨ 核心功能 (v1.4)

### 1. 增强型重名检测
- **灵活的检测范围**：支持全局检测和同级（兄弟节点）检测。
- **智能过滤规则**：
  - **白名单**：允许特定的节点名重复（如 `Viewport`, `Content`）。
  - **黑名单**：强制禁止特定的节点名重复。
  - **前缀过滤**：只检测特定前缀的节点（如 `c_`, `m_`）。
  - **UGUI 组件检测**：检测同类型的组件节点是否重名。
- **可视化设置**：在 Settings 标签页中集中管理所有规则。

### 2. 批量检测与导出
- **预制体索引集成**：在 "预制体索引" 标签页中直接进行批量操作。
- **统一检测规则**：批量检测自动使用 Settings 中配置的公用检测规则，确保检测标准一致。
- **批量检测**：一键检测选中的多个预制体，支持进度显示和取消操作。
- **CSV 导出**：自动生成检测报告，包含：
  - 所属文件夹
  - 预制体名称
  - 是否存在重复命名（是/否）
  - 重名节点详情（节点名及重复次数）

### 3. 重命名历史与回滚
- **历史记录**：自动记录每一次重命名操作。
- **一键回滚**：支持撤销重命名操作，恢复到之前的状态。
- **可视化界面**：在重名检测面板底部查看操作历史。

### 4. 数据管理优化
- **统一存储**：支持自定义数据存储路径。
- **CSV 归档**：检测报告自动保存到 `CSV_Exports` 目录。
- **历史归档**：重命名历史自动保存到 `Rename_History` 目录。
- **索引缓存**：预制体索引自动保存，启动即用。

## 📦 安装与使用

1. 将 `UIProbe` 文件夹放入项目的 `Assets` 目录中（建议放在 Editor 目录下或独立的工具目录）。
2. 在 Unity 菜单栏点击 `Tools > UIProbe` 打开窗口。
3. **设置**：首次使用建议先到设置页配置检测规则。
4. **索引**：在索引页点击"刷新"构建预制体索引。

## 🛠️ 配置说明

在设置页面可以配置：
- **检测模式**：Smart（智能过滤） / Strict（严格模式）
- **检测范围**：Global（全局） / SameLevel（同级）/ Children（子节点）
- **白名单/黑名单**：自定义允许或禁止重复的节点名称
