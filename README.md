# UIProbe

Unity UI 界面探针工具，提供预制体索引、界面快照记录、重名检测等功能。

## ✨ 最新更新 (v1.7.7)

### 动画路径自动修复 (增强版)
- **精确层级匹配**：修复逻辑升级为基于层级路径的精确匹配，彻底解决同名节点误伤问题
- **智能引用检测**：重命名节点时，自动检测预制体中关联的动画剪辑
- **一键批量修复**：发现断连的动画引用时，可一键批量更新所有从属的 AnimationClip
- **防误操作**：提供操作确认对话框，告知将影响的动画和属性列表

---

## ✨ v1.7.6 功能

### 动画路径自动修复 (基础版)
- **如果从旧版本升级，建议直接使用 v1.7.7，包含更安全的修复逻辑**

---

## ✨ v1.7.5 功能

### 文件夹排除过滤
- **团队协作支持**：导入批量检测结果后可按文件夹过滤
- **可视化选择**：展开过滤面板，勾选/取消勾选要显示的文件夹
- **问题数统计**：每个文件夹显示包含的问题预制体数量
- **持久化设置**：排除的文件夹自动保存，下次导入自动应用
- **快捷操作**：支持"全选"和"全不选"快速切换

**使用场景**：团队分工时，每个成员只需关注自己负责的模块文件夹

---

## ✨ v1.7.4 功能

### CSV导出增强
- **双模式导出**：批量检测结果支持两种导出模式
  - **简化模式**：预制体+重复节点汇总（名称+数量）
  - **详细模式**：每个重复节点完整路径单独一行
- **智能过滤**：自动过滤无重复命名的预制体，只导出有问题的项
- **路径优化**：详细模式显示"所属文件夹"而非完整预制体路径，避免冗余

---

## ✨ v1.7.3 功能

### Device Simulator支持
- **触摸输入支持**：运行时拾取(Picker)现在支持触摸输入
- **Simulator兼容**：可在Unity Device Simulator中正常使用拾取功能

### CSV导出增强
- **完整字段导出**：批量检测CSV新增"是否已处理"、"处理时间"、"是否已弃用"、"弃用时间"列

### UI优化
- **布局修复**：重命名检测组收起时不再占用过多空间
- **按钮对齐**：弃用/打开按钮统一宽度，确保对齐


## ✨ v1.7.2 功能

### 用户体验改进
- **输入框焦点优化**：重命名应用后自动清空输入框并释放焦点
- **弃用标记功能**：批量检测支持标记已弃用预制体
- **自动过滤**：导入批量结果时自动排除已弃用项
- **视觉反馈**：已弃用项显示灰色背景和⛔图标

**弃用功能使用：**
- 点击卡片上的"弃用"按钮标记废弃预制体
- 已弃用项在下次导入时自动过滤
- 可随时点击"恢复"取消弃用状态

---

## ✨ v1.7.1 功能

### 历史记录三层结构优化
- **智能分组**：同一预制体在同一天的记录合并到一个JSON文件
- **三层折叠**：日期 → 预制体 → 具体记录
- **紧凑显示**：预制体内记录采用紧凑格式，节省空间
- **批量管理**：可删除整个预制体的所有记录
- **避免重复**：不再为每次重命名创建新文件

**UI结构示例：**
```
📅 2026-01-19 (2个预制体, 共5条)
  📦 MainPanel (3条记录)
    1. 20:30:45 - Button → CloseButton
    2. 20:41:23 - Image → BackgroundImage
  📦 DialogPanel (2条记录)
    1. 20:55:57 - Panel → ContentPanel
```

---

## ✨ v1.7.0 功能

### 1. 重命名历史记录系统重构
- **文件组织**：按日期文件夹自动组织（Rename_History/2026-01-19/）
- **独立存储**：每条记录独立JSON文件（预制体名_时间戳.json）
- **折叠展示**：按日期分组，点击展开/收起
- **灵活删除**：支持删除单条记录或整个日期文件夹
- **性能优化**：延迟加载，避免单文件过大

### 2. 重命名工作流优化
- **焦点保持**：重命名后自动展开对应组，无需滚动查找
- **智能提示**：组消失时（已无重名）控制台显示提示
- **流畅体验**：连续处理同一组节点更便捷

### 3. 设置持久化修复
- **自动保存**：所有检测规则修改立即保存
- **跨会话保持**：关闭重开窗口设置不会重置
- **完整支持**：检测范围、过滤模式、前缀、白名单、黑名单全部自动保存

---

## ✨ v1.6 功能

### 1. 批量检测工作流优化
- **进度跟踪**：支持处理状态标记，已处理卡片显示绿色背景✅
- **智能完成**：打开预制体自动检测，无重名自动标记完成
- **返回功能**：单个检测显示"返回批量结果"按钮
- **进度显示**：工具栏显示处理进度（已处理 X/Y）
- **状态持久化**：处理状态保存到JSON，跨会话保持

### 2. 界面体验优化  
- **子标签系统**：重名检测页面分为「检测功能」和「历史记录」
- **自动刷新**：重命名后自动重新检测，实时更新
- **搜索历史管理**：历史记录新增✕删除按钮
- **CSV自动保存**：批量检测CSV自动保存到配置目录

---

## ✨ v1.5 功能

### 1. 索引持久化
- **自动保存索引**：刷新索引后自动保存到磁盘，无需每次重新扫描。
- **自动加载索引**：打开窗口时自动加载上次的索引，启动更快速。
- **智能检测**：自动检测索引根路径变化，提示刷新。
- **显示更新时间**：界面显示索引的上次更新时间。
- **存储位置**：`<主文件夹>/IndexCache.json`（默认在AppData）

### 2. 界面优化
- **搜索清除按钮**：搜索框输入后显示 ✕ 按钮，一键清空并恢复索引状态。
- **CSV格式改进**：批量检测导出增加"是否存在重复命名"列（是/否），便于快速筛选。

---

## ✨ 核心功能 (v1.4)

### 1. 增强型重名检测
- **灵活的检测范围**：支持全局检测和同级（兄弟节点）检测。
- **智能过滤规则**：
  - **白名单**：允许特定的节点名重复（如 `Viewport`, `Content`）。
  - **黑名单**：强制禁止特定的节点名重复。
  - **前缀过滤**：只检测特定前缀的节点（如 `c_`, `m_`）。
  - **UGUI 组件检测**：检测同类型的组件节点是否重名。
- **可视化设置**：在 Settings 标签页中集中管理所有规则。

### 2. 批量检测与导出
- **预制体索引集成**：在 "预制体索引" 标签页中直接进行批量操作。
- **统一检测规则**：批量检测自动使用 Settings 中配置的公用检测规则，确保检测标准一致。
- **批量检测**：一键检测选中的多个预制体，支持进度显示和取消操作。
- **CSV 导出**：自动生成检测报告，包含：
  - 所属文件夹
  - 预制体名称
  - 是否存在重复命名（是/否）
  - 重名节点详情（节点名及重复次数）

### 3. 重命名历史与回滚
- **历史记录**：自动记录每一次重命名操作。
- **一键回滚**：支持撤销重命名操作，恢复到之前的状态。
- **可视化界面**：在重名检测面板底部查看操作历史。

### 4. 数据管理优化
- **统一存储**：支持自定义数据存储路径。
- **CSV 归档**：检测报告自动保存到 `CSV_Exports` 目录。
- **历史归档**：重命名历史自动保存到 `Rename_History` 目录。
- **索引缓存**：预制体索引自动保存，启动即用。

## 📦 安装与使用

1. 将 `UIProbe` 文件夹放入项目的 `Assets` 目录中（建议放在 Editor 目录下或独立的工具目录）。
2. 在 Unity 菜单栏点击 `Tools > UIProbe` 打开窗口。
3. **设置**：首次使用建议先到设置页配置检测规则。
4. **索引**：在索引页点击"刷新"构建预制体索引。

## 🛠️ 配置说明

在设置页面可以配置：
- **检测模式**：Smart（智能过滤） / Strict（严格模式）
- **检测范围**：Global（全局） / SameLevel（同级）/ Children（子节点）
- **白名单/黑名单**：自定义允许或禁止重复的节点名称
