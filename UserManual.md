# UIProbe 使用手册

**UIProbe** 是一个功能全面的 Unity UI 开发辅助工具集,专为提升 UI 开发效率和质量而设计。它涵盖了从**资源索引**、**质量检测**、**运行时调试**到**批量操作**等全方位解决方案,帮助团队解决 UI 开发中的常见痛点:

- 🔍 **智能索引与搜索** - 快速检索项目中的所有 UI 预制体和资源引用
- ✅ **综合质量检测** - 自动发现重名节点、性能问题(Raycast Target)、资源丢失等常见问题
- 🔄 **协作式重命名工作流** (v2.5新增) - 避免改名导致的代码报错,支持导出重命名规划给程序员
- 🎯 **运行时拾取与调试** - Play 模式下点击界面即可定位 UI 元素,支持 Device Simulator
- 🛠️ **实用工具集** - 图片规范化、高清截图、TMP 富文本生成器等
- ⚡ **预制体助手** - 快速创建 UI 节点、九宫格锚点、智能布局应用

本文档详细介绍了 v2.5.0 版本的所有功能模块。

---

## 目录

1. [安装与启动](#1-安装与启动)
2. [功能模块详情](#2-功能模块详情)
    - [2.1 预制体索引 (Prefab Indexer)](#21-预制体索引-prefab-indexer)
    - [2.2 预制体综合检测 (Comprehensive Check)](#22-预制体综合检测-comprehensive-check)
        - [综合检测](#综合检测)
        - [预重命名 (Pre-Rename)](#预重命名-pre-rename)
        - [修改历史](#修改历史)
    - [2.3 资源引用 (Asset References)](#23-资源引用-asset-references)
    - [2.4 预制体嵌套总览 (Nesting Overview)](#24-预制体嵌套总览-nesting-overview)
    - [2.5 运行时拾取 (Runtime Picker)](#25-运行时拾取-runtime-picker)
    - [2.6 实用工具](#26-实用工具)
        - [图片规范化 (Image Normalizer)](#图片规范化-image-normalizer)
        - [游戏截屏 (Screenshot)](#游戏截屏-screenshot)
        - [TMP 富文本生成器](#tmp-富文本生成器)
    - [2.7 预制体助手 (Prefab Helper)](#27-预制体助手-prefab-helper)
3. [设置与配置](#3-设置与配置)

---

## 1. 安装与启动

1.  **安装**: 将 `UIProbe` 文件夹放置在项目的 `Assets` 目录下的任意位置（建议放在 `Editor` 或工具目录中）。
2.  **启动**: 在 Unity 菜单栏中点击 `Tools > UIProbe` 即可打开工具窗口。

---

## 2. 功能模块详情

### 2.1 预制体索引 (Prefab Indexer)

这是 UIProbe 的核心基础模块，用于建立项目中所有 UI 预制体的索引数据库，支持快速检索和批量操作。

*   **建立索引**: 首次使用或资源变动后，点击右上角的 **"🔄 刷新索引"** 按钮。工具会扫描项目中的预制体并建立缓存。
*   **搜索**: 在顶部的搜索框输入预制体名称，可实时过滤树状列表。
*   **批量操作**: 勾选 **"批量操作"** 复选框，可以多选预制体，然后进行批量检测或导出。
*   **右键菜单**: 在列表项上右键，可以快速选中文件、打开预制体或复制路径。

### 2.2 预制体综合检测 (Comprehensive Check)

集成了 UI 开发中最常用的质量检查和重构功能。

#### 综合检测
在一个面板中同时检查多种 UI 问题：
1.  **重名节点**: 检查预制体中是否存在同名节点（会导致 `transform.Find` 路径歧义）。
    *   *设置*: 可配置检测范围（全局/同级）和黑白名单。
2.  **Raycast Target 优化**: 扫描开启了 `Raycast Target` 但没有添加交互组件（如 Button）的图片/文本，这些组件会无谓地消耗由于射线检测带来的性能。
    *   *一键修复*: 支持批量关闭不必要的 Raycast Target。
3.  **资源/组件丢失**: 检测 Missing Script（脚本丢失）和 Null Sprite/Font 引用。

#### 预重命名 (Pre-Rename) ✨ *v2.5.0 新功能*
专为团队协作设计的重命名工作流，解决 "改了节点名但代码尚未修改" 导致的报错问题。

**使用流程**:
1.  **规划 (导出)**:
    *   在检测面板中输入想要修改的新名称。
    *   **不要**直接点击应用，而是点击 **"导出重命名配置 (JSON)"**。
    *   将生成的 `.json` 文件提交给程序或协作成员。
2.  **开发**:
    *   程序员根据 JSON 中的规划，修改代码中的 `transform.Find("OldName")` 为 `transform.Find("NewName")`。
3.  **应用 (导入)**:
    *   在工具中点击 **"导入重命名配置"**，选择 JSON 文件。
    *   工具会自动填充输入框（显示为蓝色背景）。
    *   确认无误后，点击 **"批量应用重命名"**。

#### 修改历史
*   记录了所有的重命名操作。
*   支持 **"回滚"** 操作，可将节点名称恢复到修改前的状态。

### 2.3 资源引用 (Asset References)

强大的反向查找工具，回答 *"这个图片/字体/材质到底被哪些 UI 用到了？"* 这个问题。

*   **类型选择**: 支持搜索 **Image** (图片), **Prefab** (嵌套预制体), **Material** (材质), **Font** (字体)。
*   **反向搜索**:
    *   选择资源类型（例如 "Image"）。
    *   输入图片名称（例如 "icon_gold"）。
    *   结果列表将显示所有引用了该图片的预制体，以及具体的节点路径。
*   **快速定位**: 点击结果中的资源名，可直接 Ping 到 Project 窗口中的资源；点击预制体名可打开对应预制体。

### 2.4 预制体嵌套总览 (Nesting Overview)

全新的嵌套关系可视化工具，用于批量排查预制体之间的嵌套引用关系，支持双向视图和智能筛选。

*   **正向视图** (默认): 显示每个预制体嵌套了哪些子预制体
    *   📦 清晰展示父预制体包含的所有嵌套预制体
    *   🔢 统计嵌套种类数量和实例总数
    *   📍 显示嵌套预制体在父预制体中的节点路径
    *   🌲 **多层嵌套检测**: 自动检测并显示深层嵌套关系（A→B→C）

*   **反向视图**: 显示每个预制体被哪些父预制体引用
    *   ← 反向索引，快速评估修改影响范围
    *   📊 统计被引用次数，识别高复用预制体
    *   ⚠️ 修改公用预制体前必备的影响评估工具

*   **强大的筛选功能**:
    *   📁 **文件夹筛选**: 只查看特定目录下的预制体嵌套关系
    *   🔢 **嵌套数量筛选**: 全部 | 有嵌套 | ≥N 种嵌套
    *   ⚡ 实时筛选，即改即查

*   **CSV 导出**:
    *   📊 一键导出当前视图数据
    *   📋 表头：序号 | 预制体文件夹 | 预制体名称 | 嵌套预制体名称 | 实例数量
    *   ✅ 适合团队汇报和存档记录

*   **多实例定位功能** (v2.7新增):
    *   📍 **单实例（×1）**: 直接显示"📍 定位"按钮，点击打开父预制体并选中嵌套实例
    *   📊 **多实例（×N）**: 显示"▶ 位置 (N)"展开按钮，列出所有实例的层级路径
    *   🎯 **独立定位**: 每个实例路径都有独立的"定位"按钮，精确定位到特定实例
    *   🗂️ **双重定位**:
        *   **📍 定位**: 打开父预制体，在Hierarchy中选中嵌套实例
        *   **📁 Project**: 在Project窗口中定位预制体资源文件
    *   ⚡ **智能切换**: 自动检测并关闭当前打开的预制体，避免保存提示弹窗

**典型使用场景**:
- 🔍 **影响评估**: 修改公用预制体（如Button_Common）前，查看有哪些界面在用它
- 📊 **复用率统计**: 找出项目中最常被嵌套的预制体，优化公共组件
- 🐛 **依赖排查**: 追踪预制体之间的依赖链，避免循环引用
- 🏗️ **架构分析**: 理解UI预制体的层级结构，为重构提供数据支持

### 2.5 运行时拾取 (Runtime Picker)

在游戏运行 (Play Mode) 时，直接点击 Game 视图中的 UI 元素来定位它们。

*   **使用方法**:
    1.  进入 Play 模式。
    2.  确保 UIProbe 窗口已打开并切换到 "Runtime Picker" 标签。
    3.  在 Game 视图中，使用快捷键点击 UI。
*   **输入模式** (可在设置中修改):
    *   `Right Click` (右键 - 推荐，不干扰 UI 逻辑)
    *   `Ctrl + Left Click`
    *   `Alt + Left Click`
    *   `Middle Click` (中键)
*   **信息面板**: 拾取后，窗口显示该 UI 元素的完整路径、挂载的组件、RectTransform 信息，并提供 "Select in Hierarchy" 按钮。
*   **Device Simulator 支持**: 完美兼容 Unity Device Simulator 的触摸模拟模式。

### 2.6 实用工具

#### 图片规范化 (Image Normalizer)
*   **功能**: 将一批图片统一调整为指定尺寸（如 512x512），通常用于制作图标图集前的预处理。
*   **特性**:
    *   保持纵横比（透明填充），不会拉伸图片内容。
    *   支持覆盖原文件或另存为新文件。
    *   支持文件夹递归扫描。

#### 游戏截屏 (Screenshot)
*   **功能**: 在 Play 模式下截取高质量游戏画面。
*   **特性**:
    *   **超采样**: 支持 2x, 3x, 4x 超大分辨率截图（适合打印或高清宣传图）。
    *   **透明背景**: 实验性功能，可截取去背的 UI 图像（需配合相机设置）。
    *   **快捷键**: `F12` 快速截图。

#### TMP 富文本生成器
*   **功能**: 可视化编辑 TextMeshPro 富文本，无需手写 `<color=#FF0000>Text</color>` 代码。
*   **特性**:
    *   **所见即所得**: 选择颜色、字号、粗体等样式。
    *   **累积模式**: 允许对一段文本的不同部分多次应用格式（例如："获得 **[宝剑]** x **1**"）。
    *   **一键复制**: 生成的代码直接复制即可使用。

### 2.7 预制体助手 (Prefab Helper)

**预制体助手**（原适配助手）不仅提供 UI 布局调整功能，还集成了常用的 UI 节点快速创建工具。

*   **功能**: 快速创建 UI 节点、设置 RectTransform 锚点、应用智能布局。
*   **模块详情**:
    *   **快速创建 (Quick Create)**:
        *   **Empty**: 在当前节点下创建空子节点。
        *   **Image**: 创建 Image 节点，可选 **No Raycast** 以优化性能。
        *   **TMP Text**: 创建 TextMeshPro 节点，可选 **No Raycast**，并支持从配置中选择**默认字体**。
    *   **快速锚点 (Quick Anchors)**:
        *   提供经典的九宫格按钮，快速将 UI 元素对齐到父节点的九个方位。
        *   支持 **一键拉伸** (水平/垂直/全屏)，自动重置 Offset。
        *   支持 **位置归零**。
    *   **智能布局 (Smart Layout)**:
        *   **全屏面板 (Full Panel)**: 一键铺满父节点，并可同时设置边距 (Padding)。
        *   **居中窗口 (Center Window)**: 将 UI 居中并设置为固定的宽高尺寸。
        *   **侧边栏 (Side Widget)**: 
            *   快速将 UI 吸附到边缘。
            *   支持 **拉伸模式 (Stretch Mode)**:
                *   开启时：使用边距 (如 Left/Right 或 Top/Bottom) 自动拉伸。
                *   关闭时：使用固定的宽度或高度。
    *   **功能联动** (新功能):
        *   **参数实时显示**: 在 Quick Anchors 区域下方显示当前 Anchor/Offset/Size 等参数，帮助理解 UI 状态。
        *   **智能状态同步**: Smart Layout 会自动检测当前锚点配置，并显示“💡 检测到xxx布局”提示。
        *   **一键应用**: 点击“应用当前状态”按钮，自动同步布局类型和参数到表单。
    *   **撤销支持**: 所有操作均支持 `Ctrl+Z` 撤销。

> [!TIP]
> **字体配置**: 请前往 **设置 (Settings)** 页面的 "预制体助手设置" 区域，将常用的 TMP 字体资源添加到列表中。这样在创建 TMP 时可以直接下拉选择字体。

---

## 3. 设置与配置

UIProbe 使用独立的配置文件，不依赖 `EditorPrefs`，方便团队共享配置。

*   **配置文件位置**:
    *   Windows: `AppData/Roaming/UIProbe/Settings/config.json`
    *   macOS: `~/Library/Application Support/UIProbe/Settings/config.json`
*   **设置项**:
    *   **检测规则**: 设置重名检测的黑/白名单、忽略前缀。
    *   **拾取习惯**: 修改 Runtime Picker 的触发热键。
    *   **自动更新**: 开启/关闭检测到新预制体时的自动刷新。

---
*文档生成于 UIProbe v2.5.0*
